---
title: 2022-04-22-äº‘å¼€å‘+æµ‹è¯•å…¬ä¼—å·æ­å»ºæ¶ˆæ¯æ¨é€å¹³å°
description: 'æœ¬æ–‡åŸºäº web ç«¯å®æ—¶æ›´æ–°çš„ todolist æ¡ˆä¾‹ï¼Œè¯¦ç»†ä»‹ç»äº†äº‘å¼€å‘æ•°æ®åº“å®æ—¶æ¨é€èƒ½åŠ›çš„ä½¿ç”¨ã€‚æ•´ä¸ªæ¡ˆä¾‹ä½¿ç”¨ CloudBase Framework å‰åç«¯ä¸€ä½“åŒ–éƒ¨ç½²å·¥å…·ï¼Œä¸€ç«™å¼å®Œæˆé¡¹ç›®çš„åˆ›å»ºã€å¼€å‘ä»¥åŠéƒ¨ç½²ã€‚'
banner: './banner.jpg'
# github ç”¨æˆ·å
authorIds:
  - yuwuwu
href: https://juejin.cn/post/7089314780804022280
platforms:
  - Web
tags:
  - ClouBase Framework
  - node
  - å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯
---


## èƒŒæ™¯

æˆ‘ä¸ªäººå¹³æ—¶åœ¨å†™ä¸€äº›è„šæœ¬æ—¶ä¼šæ¥å…¥å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥ä»¥åŠæ­å»ºä¸ªäººæœåŠ¡å™¨éƒ¨ç½²æœåŠ¡ï¼Œè€Œå‰è€…éœ€è¦è®¤è¯ä¸»ä½“ä¸ºéä¸ªäººçš„å…¬ä¼—å·ï¼Œåè€…ä¹Ÿéœ€è¦è´­ä¹°å„ç§äº‘æœåŠ¡å™¨ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯æœ‰ä¸€å®šæˆæœ¬çš„ã€‚å…¬ä¼—å·çš„é—®é¢˜å¯ä»¥ä½¿ç”¨è…¾è®¯å®˜æ–¹æä¾›çš„æµ‹è¯•å·è§£å†³ï¼Œè€ŒæœåŠ¡å™¨ä¸€ç›´æ˜¯è¹­åŒåä¸€ä»˜è´¹è´­ä¹°çš„ã€‚ç›´åˆ°æˆ‘æ¥è§¦åˆ°è…¾è®¯äº‘å¼€å‘ï¼Œäº‘å¼€å‘ä¸éœ€è¦æˆ‘æ­å»ºæœåŠ¡å™¨ã€æ•°æ®åº“ï¼Œè€Œä¸”æ¯ä¸ªæœˆéƒ½æœ‰å…è´¹çš„è°ƒç”¨é¢åº¦ï¼Œå¯ä»¥çœå»æœåŠ¡å™¨çš„è´¹ç”¨ã€‚æˆ‘å°±å¼€å§‹å°†è‡ªå·±çš„æœåŠ¡éƒ½é€æ¸è¿ç§»åˆ°è…¾è®¯äº‘ä¸Šã€‚

è¿™æ¬¡ä¸»è¦å†™çš„æ˜¯<b>äº‘å‡½æ•° + æµ‹è¯•å…¬ä¼—å·æ­å»ºä¸€ä¸ªå¾®ä¿¡æ¶ˆæ¯æ¨é€å¹³å°</b>ç±»ä¼¼äº [serveré…±](https://sct.ftqq.com/upgrade?fr=sc)ï¼Œå› ä¸ºserveré…±å¯¹æ‰€æœ‰å¼€å‘è€…å¼€æ”¾ï¼Œæ‰€ä»¥ä¼šå¯¹ä½¿ç”¨è€…æœ‰ä¸€äº›è¯·æ±‚æ¬¡æ•°ä¸Šé™çš„é™åˆ¶,éä¼šå‘˜æ—¥ä¸Šé™ä»…5æ¬¡ï¼Œæˆ‘æ‰ä¼šè‡ªå·±æ­å»ºä¸€ä¸ªæ¶ˆæ¯æ¨é€å¹³å°ã€‚æœ¬æ–‡ä¹ŸåŒæ ·é€‚ç”¨äºæœ‰ä¼ä¸šä¸»ä½“çš„å…¬ä¼—å·æ­å»ºæ¨¡æ¿æ¶ˆæ¯æ¨¡å—ã€‚

## å¼€å‘å‡†å¤‡å·¥ä½œ

### 1. ç”³è¯·æµ‹è¯•å…¬ä¼—å·

ä»å®˜ç½‘[https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)å¾®ä¿¡æ‰«ç ç™»å½•å°±å¯ä»¥æ³¨å†Œè‡ªå·±çš„æµ‹è¯•å…¬ä¼—å·ã€‚

### 2. å‡†å¤‡äº‘å¼€å‘ç¯å¢ƒ

#### 2.1 åˆ›å»ºäº‘å¼€å‘ç¯å¢ƒ

ç™»å½• è…¾è®¯äº‘å®˜ç½‘ > æ§åˆ¶å° > äº‘å¼€å‘ > å¼€é€šäº‘å¼€å‘ï¼Œç„¶åç‚¹å‡»å·¦ä¸Šè§’æ–°å»ºæŒ‰é’®ã€‚

æˆ‘åœ¨è¿™é‡Œé€‰æ‹©çš„æ˜¯expressåº”ç”¨ï¼›ç„¶åæŒ‰ç…§å›¾ç¤ºåˆ›å»ºä¸€ä¸ªäº‘å¼€å‘ç¯å¢ƒã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/788e4a1438024ce895ff35bbf1690fbc~tplv-k3u1fbpfcp-watermark.image?)
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ec52543737842d1a927728026a10347~tplv-k3u1fbpfcp-watermark.image?)
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f55ef06a0644a2793bce78a0feb53a4~tplv-k3u1fbpfcp-watermark.image?)

#### 2.2 å®‰è£…cloudbase/cli

cloudbase/cliæ˜¯å®˜æ–¹æä¾›çš„äº‘å¼€å‘è„šæ‰‹æ¶ï¼Œä»–å¯ä»¥å¸®åŠ©ä½¿ç”¨è€…å¿«é€Ÿæ–¹ä¾¿çš„ç®¡ç†äº‘å¼€å‘çš„é¡¹ç›®å’Œèµ„æºã€‚
```
npm i -g @cloudbase/cli
```

#### 2.3 ç™»å½•äº‘å¼€å‘

åœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¼šæ‰“å¼€æµè§ˆå™¨é¡µé¢ï¼Œåœ¨é¡µé¢å†…ç™»å½•è‡ªå·±çš„è´¦å·,ç„¶åç‚¹å‡»ç¡®è®¤æˆæƒã€‚

```
cloudbase login
```

#### 2.4 åˆ›å»ºéƒ¨ç½²äº‘å‡½æ•°
åˆ›å»ºäº‘å‡½æ•°çš„è¯å¯ä»¥é€šè¿‡ äº‘å‡½æ•° > æ–°å»ºäº‘å‡½æ•° åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡cliå·¥å…·åˆ›å»ºï¼Œè¿™é‡Œä¸»è¦è®²è§£ç¬¬äºŒç§æ–¹æ¡ˆã€‚

è¾“å…¥ä»¥ä¸‹å‘½ä»¤åˆ›å»ºé¡¹ç›®ï¼Œåœ°åŸŸä¸å…³è”ç¯å¢ƒéœ€è¦ä¸2.1æ­¥éª¤åˆ›å»ºæ—¶ä¿¡æ¯ä¸€è‡´ï¼Œåªæœ‰å…³è”äº†ç¯å¢ƒæ‰å¯ä»¥ä¸€é”®éƒ¨ç½²ã€‚æ‰§è¡Œå®Œæˆåå°±ä¼šåˆ›å»ºä¸€ä¸ªåŸºäº`express`çš„é¡¹ç›®æ¨¡æ¿ã€‚

```
cloudbase new [project-name]
```
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94a293072e374e30a96ea66e2dea2aeb~tplv-k3u1fbpfcp-watermark.image?)

è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éƒ¨ç½²äº‘å‡½æ•°ã€‚éƒ¨ç½²å®Œæˆåå›åˆ°äº‘å‡½æ•°æ§åˆ¶å°ï¼Œä¼šå‘ç°åˆšæ‰åˆ›å»ºçš„ç¯å¢ƒä¸‹å¤šäº†ä¸€ä¸ªäº‘å‡½æ•°ã€‚
```
cloudbase framework deploy
```
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1bc72768fe384f3d8efd8d2d5f13863d~tplv-k3u1fbpfcp-watermark.image?)

å¦‚æœæƒ³è¦ä¿®æ”¹äº‘å‡½æ•°çš„å‡½æ•°ID/åç§°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹`cloudbaserc.json`æ–‡ä»¶`inputs.name`å­—æ®µå®ç°ã€‚
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b079524010f4db98594487d6dc8ce7e~tplv-k3u1fbpfcp-watermark.image?)

## å¼€å‘

æˆ‘ä»¬éœ€è¦è°ƒç”¨å¾®ä¿¡çš„apiï¼Œæ‰€ä»¥å¿…é¡»éµå®ˆå¾®ä¿¡çš„ä¸€äº›éªŒç­¾ä¼ å‚è§„åˆ™ã€‚ä¸‹å›¾æ˜¯æˆ‘æ¢³ç†å‡ºçš„è°ƒç”¨å¾®ä¿¡ä¸šåŠ¡çš„æµç¨‹ã€‚
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9198e46f42a40a6968b0e8eeb776075~tplv-k3u1fbpfcp-watermark.image?)

### 1. å¾®ä¿¡æ¥å£é…ç½®

é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º`utils`æ–‡ä»¶å¤¹å’Œ`utils/wxConfig.js`æ–‡ä»¶ï¼Œç”¨æ¥å­˜æ”¾å¾®ä¿¡å…¬ä¼—å·çš„é…ç½®ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ee6a50d3bac42ba9bd1839f818255cc~tplv-k3u1fbpfcp-watermark.image?)
`appId`å’Œ`secret`å¯ä»¥ä»æµ‹è¯•å…¬ä¼—å·åå°è·å–ï¼Œ`token`æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥éªŒè¯å¾®ä¿¡æœåŠ¡å™¨å“åº”çš„ã€‚
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/120e55c9dab14205a3c9aaee39804cb8~tplv-k3u1fbpfcp-watermark.image?)


ç¼–è¾‘`routes/index.js`:

ps:éœ€è¦å®‰è£…sha1ä¾èµ–,å¯¹å‚æ•°åŠ å¯†ã€‚`npm install sha1`
```js
const express = require("express");
const config = require("../utils/wxConfig.js")
const sha1 = require('node-sha1')
const router = express.Router();

// éªŒè¯æ¶ˆæ¯æ¥è‡ªå¾®ä¿¡æœåŠ¡å™¨
router.get("/", function (req, res, next) {
	const token = config.token
	const signature = req.query.signature
	const nonce = req.query.nonce
	const timestamp = req.query.timestamp
	const str = [token, timestamp, nonce].sort().join('')
	const sha = sha1(str)
	if (sha === signature) {
		const echostr = req.query.echostr; //è·å–å¾®ä¿¡è¯·æ±‚å‚æ•°echostr
		res.send(echostr + ''); //æ­£å¸¸è¿”å›è¯·æ±‚å‚æ•°echostr
	} else {
		res.send('éªŒè¯å¤±è´¥');
	}
});
```
è¿™ä¸ªæ¥å£çš„ä¸šåŠ¡æµç¨‹ä¸ºå¾®ä¿¡å®˜æ–¹æä¾›çš„å›ºå®šå†™æ³•ã€‚å†™å®Œè¿™ä¸ªæ¥å£åéƒ¨ç½²äº‘å‡½æ•°,æˆ‘ä»¬å°±å¯ä»¥é…ç½®æµ‹è¯•å…¬ä¼—å·åå°çš„â€œæ¥å£é…ç½®ä¿¡æ¯â€å’Œâ€œjsæ¥å£å®‰å…¨åŸŸåâ€äº†ã€‚å…¶ä¸­tokenå¡«å†™çš„å°±æ˜¯ä¸Šä¸€æ­¥`utils/wxConfig.js`ä¸­è‡ªå®šä¹‰çš„token;åŸŸååˆ™æ¥è‡ª äº‘å‡½æ•°åå° > äº‘å‡½æ•° > httpè®¿é—®æœåŠ¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ¥å£é…ç½®çš„URLå°±æ˜¯ä¸Šä¸€æ­¥å†™çš„éªŒè¯å¾®ä¿¡æœåŠ¡å™¨æ¶ˆæ¯æ¥å£çš„è®¿é—®åœ°å€ï¼Œè€Œjsæ¥å£å®‰å…¨åŸŸååªéœ€è¦å¡«å†™åŸŸåã€‚
```
cloudbase framework deploy
```
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59c2f6ae8692484f8faf59416c4a5554~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2740d874886436995abbbc09f31d9c8~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9754c1aef15f46df8b55fa1d890ff344~tplv-k3u1fbpfcp-watermark.image?)


### 2. è·å–ç”¨æˆ·openid

æ ¹æ®æˆ‘æ¢³ç†å‡ºçš„å¾®ä¿¡ä¸šåŠ¡æµç¨‹å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œè·å–ç”¨æˆ·openidéœ€è¦å…ˆè·å–ç”¨æˆ·çš„code,è€Œcodeæ˜¯ç”¨æˆ·æˆæƒåï¼Œå¾®ä¿¡ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼è¿”å›çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå¤„ç†å¾®ä¿¡æˆæƒã€‚

#### 2.1 å¾®ä¿¡æˆæƒæ¥å£

åœ¨æµ‹è¯•å…¬ä¼—å· > ä½“éªŒæ¥å£æƒé™è¡¨ > ç½‘é¡µæœåŠ¡ > ç½‘é¡µè´¦å· > ä¿®æ”¹  å¼¹å‡ºçš„å¼¹çª—å†…å¡«å†™æˆæƒå›è°ƒåŸŸåï¼ŒåŸŸåè·Ÿä¸Šä¸€æ­¥çš„jsæ¥å£å®‰å…¨åŸŸåä¸€æ ·ã€‚
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e318a1490f95440f840479e37c8e8099~tplv-k3u1fbpfcp-watermark.image?)
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9bdf289d2e9642b899717774df12cb94~tplv-k3u1fbpfcp-watermark.image?)

ç¼–è¾‘`routes/index.js`:

ps:éœ€è¦å®‰è£…urlencodeä¾èµ–ï¼Œå¯¹å›è°ƒåœ°å€ç¼–ç å¤„ç†`npm install urlencode`

```js
// ç½‘é¡µæˆæƒå›è°ƒè·å–code
router.get("/authorize", function (req, res, next) {
	const appid = config.appid
	const redirect_uri = urlencode("https://send-wx-message-xxxxxxxxxxx.ap-shanghai.app.tcloudbase.com/express-starter/getUserInfo")
	res.redirect(`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${appid}&redirect_uri=${redirect_uri}&response_type=code&scope=snsapi_userinfo&state=STATE&connect_redirect=1#wechat_redirect`)
});
```
é€šè¿‡é‡å®šå‘è°ƒç”¨å¾®ä¿¡çš„æˆæƒæ¥å£ï¼ŒæˆæƒæˆåŠŸåå¾®ä¿¡åˆä¼šé‡å®šå‘åˆ°redirect_uriå¹¶ä¸”æºå¸¦ç”¨æˆ·`code`ï¼Œè¿™ä¸ª`code`åªèƒ½è¢«ä½¿ç”¨1æ¬¡ï¼Œå¹¶ä¸”æœ‰æœ‰æ•ˆæœŸã€‚

#### 2.2 è·å–openId

ä¸Šä¸€æ­¥ä¸­ï¼Œå¾®ä¿¡ä¼šé‡å®šå‘åˆ°æˆ‘ä»¬çš„å›è°ƒåœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†ç»§ç»­å†™ä¸€ä¸ªgetæ¥å£ï¼Œè·å–åˆ°å›è°ƒä¸­çš„codeå‚æ•°ï¼Œå»å¾®ä¿¡æœåŠ¡å™¨æ¢å–openidã€‚

é˜²æ­¢`routes/index.js`é‡Œä»£ç å¤ªå¤šï¼Œå¯è¯»æ€§å·®ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`models/wxApi.js`,å°†è°ƒç”¨å¾®ä¿¡çš„è¯·æ±‚éƒ½æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶ä¸‹ï¼ˆä¸ªäººä¹ æƒ¯ï¼‰
```js
//routes/index.js
// æ ¹æ®codeå½“å‰ç”¨æˆ·æŸ¥è¯¢ä¿¡æ¯
router.get("/getUserInfo", async (req, res, next)=> {
	try {
		const {appid,secret} = config
		const code =  req.query.code
		const res_getOpenid = await getOpenid(appid,secret,code)
        if(res_getOpenid.openid){
			res.render("index", { title: "å¤åˆ¶key" ,openid:res_getOpenid.openid});
		}else{
			res.render("error", { res_getOpenid});
		}
	} catch (error) {
		res.render("error", { errcode:500,errmsg: error });
	}
	
});
```
ps:éœ€è¦å®‰è£…axiosä¾èµ–,å‘èµ·è¯·æ±‚ã€‚`npm install axios`
```js
//models/wxApi.js
const axios = require("axios");

module.exports = {
    getOpenid: async (appid, secret, code) => {
        const url = `https://api.weixin.qq.com/sns/oauth2/access_token?appid=${appid}&secret=${secret}&code=${code}&grant_type=authorization_code`
        const { data } = await axios({
            url: url
        })
        return data
    },
}
```
æœ€ç»ˆæˆ‘è¿”å›äº†ä¸€ä¸ªé¡µé¢ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨é¡µé¢å†…å¤åˆ¶è‡ªå·±çš„`openId`ã€‚
![xiaoguo.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0fdfac29a3642c1a9bdf8a319441c3d~tplv-k3u1fbpfcp-watermark.image?)

### 3. æ¨é€å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯

æ¨é€æ¨¡æ¿æ¶ˆæ¯ä¸»è¦ä¾èµ–`access_token`å’Œ`æ¨¡æ¿æ¶ˆæ¯Id`,æ‰€ä»¥æˆ‘ä»¬ä¸»è¦åˆ†ä¸ºè¿™ä¸¤æ­¥ã€‚

```js
//routes/index.js
// æ¨é€æ¨¡æ¿æ¶ˆæ¯
router.post("/sendMessage",async  (req, res, next)=> {
	try {
		const {openid,title,desc} = req.body
		const {appid,secret} = config
		const res_getAccessToken = await getAccessToken(appid,secret)
		if(res_getAccessToken.errcode > 0){
			res.send(res_getAccessToken)
			return
		}
		const res_sendWxMessage = await sendWxMessage(openid,res_getAccessToken.access_token,title,desc)
		if(res_sendWxMessage.errcode > 0){
			res.send(res_sendWxMessage)
			return
		}
		res.send({
			errcode:0,
			errmsg:'ok'
		})
	} catch (error) {
		res.send( { errcode:500,errmsg: error });
	}
})
```
#### 3.1 è·å–access_token

```js
//models/wxApi.js
    getAccessToken: async (appid, secret) => {
        const accessTokenJson = global.accessTokenJson || {}
        const nowTime = new Date().getTime()
        // æå‰åŠå°æ—¶åˆ·æ–°access_token
        if (accessTokenJson.access_token && (nowTime - accessTokenJson.createTime < (accessTokenJson.expires_in - 1800) * 1000)) {
            return accessTokenJson
        } else {
            const { data } = await axios({
                url: `https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=${appid}&secret=${secret}`
            })
            if (data.access_token) {
                    global.accessTokenJson = {...data,createTime:nowTime}
            }
            return data
        }

    },
```


å› ä¸ºå¾®ä¿¡æä¾›çš„è·å–`access_token`æ¥å£æœ‰è°ƒç”¨ä¸Šé™ï¼Œå¹¶ä¸”`access_token`æœ‰æ•ˆæœŸä¸º2ä¸ªå°æ—¶ï¼Œæ‰€ä»¥éœ€è¦å¯¹`access_token`è¿›è¡Œç¼“å­˜ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯å°†`access_token`å†™å…¥globalï¼Œå¹¶è®°å½•å†™å…¥æ—¶é—´ï¼Œè·å–æ—¶å…ˆæŸ¥çœ‹globalçš„æ•°æ®æ˜¯å¦è¿‡æœŸã€‚

#### 3.2 æ¨é€æ¨¡æ¿æ¶ˆæ¯

é¦–å…ˆåˆ›å»ºæ¶ˆæ¯æ¨¡æ¿ï¼Œæµ‹è¯•å…¬ä¼—å·åå° > æ¨¡æ¿æ¶ˆæ¯æ¥å£ > æ–°å¢æµ‹è¯•æ¨¡æ¿,æ ‡é¢˜å’Œå†…å®¹éƒ½å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯åªæœ‰å†…å®¹æ”¯æŒå˜é‡ï¼Œå˜é‡éœ€è¦éµå®ˆä¸€å®šçš„æ ¼å¼ â€œ{{å˜é‡.DATA}}â€ã€‚æäº¤åè·å–åˆ°æ¨¡æ¿idã€‚
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c833b1544f834674a40e9ec3ffb93dc4~tplv-k3u1fbpfcp-watermark.image?)
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b9e9c897fd548f29dd6dcf8224858c3~tplv-k3u1fbpfcp-watermark.image?)

```js
//models/wxApi.js
    sendWxMessage: async (openid, access_token, title, desc) => {
        const json = {
            touser: openid,
            template_id: 'Hzz2IF_rF59sOBDdVtrXntuTC4E98XLGUl6_PGUYBHg',
            topcolor: "#FF0000",
            data: {
                title: {
                    value: title,
                    color: "#173177"
                },
                desc: {
                    value: desc,
                    color: '#173177'
                }
            }
        }
        const { data } = await axios({
            method: "post",
            url: `https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=${access_token}`,
            data: json
        })
        return data
    }
}
```
å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯æ¥å£å…¥å‚ä¸ºå›ºå®šæ ¼å¼ï¼Œ`touser`æ˜¯æ¥æ”¶äººçš„openidï¼Œ `template_id`æ˜¯æ¶ˆæ¯æ¨¡æ¿idï¼Œ `data`é‡Œçš„å†…å®¹ä¸ºåˆ›å»ºæ¨¡æ¿æ¶ˆæ¯å†…å®¹æ—¶çš„å˜é‡åã€‚

å®Œæˆè¿™ä¸€æ­¥æ•´ä¸ªåŠŸèƒ½å°±å¼€å‘å®Œäº†ï¼Œæˆ‘ä»¬å†éƒ¨ç½²ä¸€ä¸‹äº‘å‡½æ•°ï¼Œè°ƒç”¨æ¶ˆæ¯æ¨é€æ¥å£ï¼Œå¾®ä¿¡ä¸Šå°±ä¼šæ”¶åˆ°æ¥è‡ªè®¢é˜…å·çš„æ¶ˆæ¯ã€‚
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec2f0523e62745a294e19640eaef7d69~tplv-k3u1fbpfcp-watermark.image?)
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1eec4429729347bfb227cb7bb2c3bd9d~tplv-k3u1fbpfcp-watermark.image?)
## ç»“å°¾
è¿™æ®µé¡¹ç›®ä»£ç ä¹Ÿé€‚ç”¨äºæ­£å¼å…¬ä¼—å·é¡¹ç›®çš„å¼€å‘ï¼Œä½†æ˜¯å¦‚æœåœ¨æ­£å¼é¡¹ç›®ä¸­ä½¿ç”¨çš„è¯è¦æ³¨æ„ä¿¡æ¯çš„åŠ å¯†ä»¥åŠå¹¶å‘çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨åŠ å¯†æ–¹å¼å¯¹ç”¨æˆ·openidè¿›è¡Œæ··æ·†åŠ å¯†ä»¥åŠå°†access_tokenå­˜å…¥redisä¸­ï¼Œå®šæ—¶åˆ·æ–°redisä¸­çš„tokenã€‚

å¦å¤–ï¼Œåœ¨è¿ç§»è…¾è®¯äº‘æ—¶æš´éœ²å‡ºä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¹‹å‰å­˜å‚¨`access_token`çš„æ–¹æ¡ˆæ˜¯é€šè¿‡`fs`è¯»å†™jsonæ–‡ä»¶çš„æ–¹æ¡ˆå®ç°çš„ï¼Œä½†æ˜¯è…¾è®¯äº‘å‡½æ•°å†™æ–‡ä»¶ä¸€ç›´å¤±è´¥ï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°æ–‡ä»¶æƒé™éƒ½æ˜¯åªè¯»çš„ï¼Œæ— æ³•å†™å…¥ï¼Œæ”¹ä¸ºäº†ä½¿ç”¨Node globalå¯¹è±¡å»å®ç°ã€‚

å®Œæ•´ä»£ç æŸ¥çœ‹[https://github.com/yuwuwu/blog-code](https://github.com/yuwuwu/blog-code/tree/master/node%E6%90%AD%E5%BB%BA%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/send-wx-message),æ¬¢è¿ç‚¹ä¸ªstarâ­ï¸ã€‚


## CloudBase Framework å¼€æºé¡¹ç›®ä»‹ç»

ğŸš€ CloudBase Framework æ˜¯äº‘å¼€å‘å¼€æºçš„äº‘åŸç”Ÿå‰åç«¯ä¸€ä½“åŒ–éƒ¨ç½²å·¥å…·ï¼Œæ”¯æŒä¸»æµå‰åç«¯æ¡†æ¶ï¼Œå‰åç«¯ä¸€é”®æ‰˜ç®¡éƒ¨ç½²åœ¨äº‘ç«¯ä¸€ä½“åŒ–å¹³å°ï¼Œæ”¯æŒæ”¯æŒå°ç¨‹åºã€Webã€Flutterã€åç«¯æœåŠ¡ç­‰å¤šä¸ªå¹³å°ã€‚

Github å¼€æºåœ°å€ï¼š[https://github.com/Tencent/cloudbase-framework](https://github.com/Tencent/cloudbase-framework)

æ¬¢è¿ç»™ CloudBase Framework ä¸€ä¸ª ğŸŒŸ star

## CloudBase Framework æ ¸å¿ƒè´¡çŒ®è€…è®¡åˆ’

æ¬¢è¿å¤§å®¶å‚ä¸ CloudBase Framework çš„å¼€å‘å·¥ä½œï¼Œæˆä¸ºæˆ‘ä»¬çš„è´¡çŒ®è€…ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨äº‘å¼€å‘ç¤¾åŒºå±•ç¤ºè´¡çŒ®è€…çš„ä½œå“å’Œä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæœ‰æƒŠå–œå¥–åŠ±ã€‚

æ‚¨å¯ä»¥é€‰æ‹©å¦‚ä¸‹çš„è´¡çŒ®æ–¹å¼ï¼š

- è´¡çŒ®æŠ€æœ¯æ–‡ç« ï¼š[https://github.com/Tencent/cloudbase-framework/tree/master/community/posts](https://github.com/Tencent/cloudbase-framework/tree/master/community/posts)
- è´¡çŒ®åº”ç”¨ï¼š[https://github.com/Tencent/cloudbase-framework/blob/master/doc/app.md](https://github.com/Tencent/cloudbase-framework/blob/master/doc/app.md)
- è´¡çŒ®ä»£ç ï¼Œæäº¤ Pull Request
- åé¦ˆ bugï¼Œæäº¤ Issue
- åœ¨æŠ€æœ¯ä¼šè®®ä¸Šå‘è¡¨æŠ€æœ¯æ¼”è®²

CloudBase Framework çš„å‘å±•ç¦»ä¸å¼€ç¤¾åŒºçš„ç§¯æè´¡çŒ®ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒè´¡çŒ®è€…åˆ—è¡¨ï¼Œå†æ¬¡æ„Ÿè°¢å¤§å®¶çš„è´¡çŒ®ï¼š[https://github.com/Tencent/cloudbase-framework#contributors-](https://github.com/Tencent/cloudbase-framework#contributors-)